<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Physio Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-print-color-adjust: exact; }
        .font-mono { font-family: 'DM Mono', monospace; }
        .transition-all-300 { transition: all 0.3s ease-in-out; }

        /* Mobile-First Adjustments */
        @media (max-width: 768px) {
            .visualizer-container { order: -1; margin-bottom: 20px; } /* Put visualizer on top on mobile? Optional, currently kept bottom */
        }

        @media print {
            body { background: white; }
            .no-print { display: none !important; }
            .print-visual { display: block !important; break-inside: avoid; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

    <div id="app" class="max-w-7xl mx-auto p-3 md:p-6 lg:p-8">

        <div class="bg-slate-900 text-white p-4 md:p-6 rounded-xl shadow-lg no-print mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <div>
                    <h2 class="text-sm font-bold uppercase tracking-widest text-slate-400">Treatment Configuration</h2>
                    <p class="text-xs text-slate-500 mt-1">Adjust dates & split routine logic.</p>
                </div>
                <div class="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700 w-full md:w-auto text-center md:text-right">
                    <span class="text-xs text-slate-400 block">Total Package</span>
                    <span class="text-xl md:text-2xl font-mono font-bold text-green-400">{{ formatCurrency(grandTotal) }}</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 items-end">
                <div>
                    <label class="block text-xs text-slate-400 mb-1 font-bold">Start Date</label>
                    <input type="date" v-model="startDate"
                           class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div>
                    <label class="block text-xs text-slate-400 mb-1 font-bold">Package Size</label>
                    <div class="flex bg-slate-800 rounded-lg p-1 border border-slate-700">
                        <button v-for="opt in [5, 8, 10]" :key="opt"
                                @click="sessionCount = opt"
                                class="flex-1 py-2 text-xs md:text-sm rounded-md transition-all-300 font-bold"
                                :class="sessionCount === opt ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400 hover:text-white'">
                            {{ opt }}
                        </button>
                    </div>
                </div>

                <div class="md:col-span-2 bg-slate-800 border border-slate-700 p-3 rounded-lg flex items-center justify-between cursor-pointer hover:bg-slate-750 transition"
                     @click="isSplitRoutine = !isSplitRoutine">
                    <div class="pr-4">
                        <div class="text-sm font-bold text-white flex items-center gap-2">
                            Enable Split Routine
                            <span v-if="isSplitRoutine" class="bg-green-500 text-slate-900 text-[9px] px-1.5 py-0.5 rounded font-bold uppercase">Active</span>
                        </div>
                        <div class="text-[10px] text-slate-400 mt-1 leading-tight">
                            Allows scheduling <strong>Upper Body</strong> and <strong>Lower Body</strong> on consecutive days (24h gap).
                        </div>
                    </div>
                    <div class="w-12 h-6 bg-slate-600 rounded-full relative transition-colors duration-300 flex-shrink-0"
                         :class="isSplitRoutine ? 'bg-green-500' : 'bg-slate-600'">
                        <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 shadow-sm"
                             :class="isSplitRoutine ? 'translate-x-6' : 'translate-x-0'"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-6 min-h-[600px]">

            <div class="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden order-2 lg:order-1">

                <div class="bg-slate-50 p-4 border-b border-slate-100 flex justify-between text-xs font-bold text-slate-500 uppercase tracking-wider sticky top-0 z-10">
                    <span>Date & Protocol</span>
                    <span>Status</span>
                </div>

                <div class="p-2 md:p-4 space-y-2">
                    <div v-for="(session, index) in generatedSchedule" :key="index"
                         @click="hoverIndex = index"
                         class="group relative flex justify-between items-center p-3 md:p-4 rounded-xl border transition-all duration-200 cursor-pointer"
                         :class="hoverIndex === index ? 'bg-blue-50 border-blue-400 ring-1 ring-blue-400' : 'bg-white border-slate-100 hover:border-slate-300'">

                        <div class="flex gap-3 md:gap-5 items-center">
                            <div class="flex flex-col items-center justify-center bg-slate-100 rounded-lg w-12 h-12 md:w-14 md:h-14 flex-shrink-0">
                                <span class="text-[9px] uppercase font-bold text-slate-400">{{ getMonth(session.date) }}</span>
                                <span class="text-lg md:text-xl font-bold text-slate-800 leading-none">{{ getDay(session.date) }}</span>
                            </div>

                            <div>
                                <div class="flex flex-wrap items-center gap-2 mb-1">
                                    <span class="text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-wide border"
                                          :class="getAreaColor(session.area)">
                                        {{ session.area }}
                                    </span>
                                    <span v-if="session.gapDays === 1" class="text-[9px] flex items-center gap-1 text-orange-700 bg-orange-100 px-1.5 py-0.5 rounded font-bold">
                                        âš¡ Split Day
                                    </span>
                                </div>
                                <h4 class="font-bold text-slate-800 text-sm md:text-base">{{ session.focus }}</h4>
                                <div class="text-[10px] text-slate-400 md:hidden mt-1">{{ session.gapLabel }}</div>
                            </div>
                        </div>

                        <div class="text-right flex-shrink-0">
                             <div class="text-xs text-slate-400 hidden md:block">{{ session.gapLabel }}</div>
                             <div class="text-sm font-mono font-bold text-slate-700 mt-1">{{ formatCurrency(discountedPrice) }}</div>
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-slate-50 border-t border-slate-100 text-center lg:text-left">
                    <p class="text-xs text-slate-500">
                        Course ends on <strong class="text-slate-900">{{ getFinishDate }}</strong>
                    </p>
                </div>
            </div>

            <div class="w-full lg:w-[380px] order-1 lg:order-2">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 md:p-6 lg:sticky lg:top-4">

                    <div class="mb-4 text-center">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Anatomy Selection</span>
                        <h3 class="text-lg font-bold text-slate-800 h-6">{{ activeSession?.focus || 'Tap a session to view' }}</h3>
                    </div>

                    <div class="flex justify-center my-4">
                        <svg width="200" height="360" viewBox="0 0 220 400" fill="none" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-lg">
                            <circle cx="110" cy="35" r="22" class="fill-white stroke-slate-200 stroke-2" />
                            <rect x="35" y="70" width="30" height="110" rx="10" class="fill-white stroke-slate-200 stroke-2" />
                            <rect x="155" y="70" width="30" height="110" rx="10" class="fill-white stroke-slate-200 stroke-2" />
                            <path d="M75 65 H145 L135 190 H85 L75 65Z" class="fill-white stroke-slate-200 stroke-2" />
                            <path d="M85 190 L75 360 H105 L110 190" class="fill-white stroke-slate-200 stroke-2" />
                            <path d="M135 190 L145 360 H115 L110 190" class="fill-white stroke-slate-200 stroke-2" />

                            <g v-if="isActive('Upper')">
                                <path d="M110 80 L135 75 L130 110 L110 120 Z" class="fill-emerald-400 opacity-90 stroke-emerald-600 stroke-2" />
                                <path d="M110 150 L135 150 L130 180 L110 180 Z" class="fill-emerald-400 opacity-90 stroke-emerald-600 stroke-2" />
                            </g>

                            <g v-if="isActive('Lower')">
                                <path d="M80 200 L105 200 L100 270 L85 270 Z" class="fill-blue-400 opacity-90 stroke-blue-600 stroke-2" /> <circle cx="90" cy="275" r="8" class="fill-blue-400 opacity-90 stroke-blue-600 stroke-2" /> <rect x="142" y="200" width="8" height="90" rx="2" class="fill-indigo-400 opacity-90 stroke-indigo-600 stroke-2" /> </g>

                            <g v-if="isActive('Veins')">
                                 <path d="M90 350 Q 85 270 90 200" stroke="#EF4444" stroke-width="3" stroke-dasharray="4 4" fill="none">
                                    <animate attributeName="stroke-dashoffset" from="20" to="0" dur="1s" repeatCount="indefinite" />
                                 </path>
                                 <path d="M130 350 Q 135 270 130 200" stroke="#EF4444" stroke-width="3" stroke-dasharray="4 4" fill="none">
                                    <animate attributeName="stroke-dashoffset" from="20" to="0" dur="1s" repeatCount="indefinite" />
                                 </path>
                            </g>
                        </svg>
                    </div>

                    <div class="mt-4 bg-slate-50 p-4 rounded-lg border border-slate-200">
                        <h4 class="text-xs font-bold text-slate-800 uppercase mb-3 border-b border-slate-200 pb-2">Color Key Description</h4>

                        <div class="space-y-3">
                            <div class="flex items-start gap-3">
                                <div class="w-4 h-4 rounded bg-emerald-400 border border-emerald-600 mt-0.5 flex-shrink-0"></div>
                                <div>
                                    <div class="text-xs font-bold text-slate-800">Upper Body (Green)</div>
                                    <div class="text-[10px] text-slate-500 leading-tight">Focus on Rhomboids & Back. <br>Safe to train Legs the next day.</div>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <div class="w-4 h-4 rounded bg-blue-400 border border-blue-600 mt-0.5 flex-shrink-0"></div>
                                <div>
                                    <div class="text-xs font-bold text-slate-800">Lower Body (Blue)</div>
                                    <div class="text-[10px] text-slate-500 leading-tight">Focus on Knees, Quads & Hips. <br>Safe to train Back the next day.</div>
                                </div>
                            </div>

                            <div class="flex items-start gap-3">
                                <div class="w-4 h-4 rounded bg-red-100 border border-red-500 flex items-center justify-center mt-0.5 flex-shrink-0">
                                    <div class="w-0.5 h-2 bg-red-500"></div>
                                </div>
                                <div>
                                    <div class="text-xs font-bold text-slate-800">Hemodynamics (Red Lines)</div>
                                    <div class="text-[10px] text-slate-500 leading-tight">Focus on Blood Flow & Veins. <br>Systemic recovery focus.</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                const startDate = ref(new Date().toISOString().split('T')[0]);
                const sessionCount = ref(8);
                const isSplitRoutine = ref(true);
                const hoverIndex = ref(null); // Acts as "Selected Session" on mobile tap
                const basePrice = 1800;

                const sessionTemplates = [
                    { area: 'Veins', focus: 'Hemodynamics', code: 'vein' },
                    { area: 'Upper', focus: 'Right Back & Rhomboid', code: 'rhomboid' },
                    { area: 'Lower', focus: 'Left Knee Structure', code: 'knee' },
                    { area: 'Veins', focus: 'Vascular Flush', code: 'vein' },
                    { area: 'Upper', focus: 'Spinal Decompression', code: 'back' },
                    { area: 'Lower', focus: 'Right Hip & ITB', code: 'hip' },
                    { area: 'Upper', focus: 'Scapular Stability', code: 'rhomboid' },
                    { area: 'Lower', focus: 'Knee Power Phase', code: 'knee' },
                    { area: 'Lower', focus: 'Nerve Integration', code: 'nerve' },
                    { area: 'Full',  focus: 'Discharge Integration', code: 'combo' }
                ];

                const generatedSchedule = computed(() => {
                    const sched = [];
                    let currentDate = new Date(startDate.value);
                    let lastArea = null;

                    for (let i = 0; i < sessionCount.value; i++) {
                        const tpl = sessionTemplates[i % sessionTemplates.length];
                        let gap = 0;

                        if (i > 0) {
                            if (isSplitRoutine.value) {
                                if (tpl.area !== lastArea && lastArea !== 'Full' && lastArea !== 'Veins' && tpl.area !== 'Veins') {
                                    gap = 1; // Split logic mainly for Upper vs Lower
                                } else {
                                    gap = 2; // Standard
                                }
                                // Exception: Veins are low impact, allow 1 day after? Let's keep 2 for safety unless specified
                                if (lastArea === 'Veins') gap = 1;
                            } else {
                                gap = 2;
                            }
                            currentDate.setDate(currentDate.getDate() + gap);
                        }

                        sched.push({
                            date: new Date(currentDate),
                            gapDays: gap,
                            gapLabel: i === 0 ? 'Start' : (gap === 1 ? 'Next Day' : gap + ' Days'),
                            ...tpl
                        });
                        lastArea = tpl.area;
                    }
                    return sched;
                });

                const discountPercent = computed(() => {
                    if (sessionCount.value === 10) return 15;
                    if (sessionCount.value === 8) return 10;
                    return 8;
                });

                const discountedPrice = computed(() => basePrice * (1 - (discountPercent.value / 100)));
                const grandTotal = computed(() => discountedPrice.value * sessionCount.value);

                const activeSession = computed(() => {
                    // Default to first session if nothing selected
                    return hoverIndex.value === null ? generatedSchedule.value[0] : generatedSchedule.value[hoverIndex.value];
                });

                const isActive = (zone) => activeSession.value ? activeSession.value.area === zone : false;

                const getFinishDate = computed(() => {
                    const last = generatedSchedule.value[generatedSchedule.value.length - 1];
                    return last ? last.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : '-';
                });

                const getAreaColor = (area) => {
                    if (area === 'Veins') return 'bg-red-50 text-red-700 border-red-200';
                    if (area === 'Upper') return 'bg-emerald-50 text-emerald-700 border-emerald-200';
                    if (area === 'Lower') return 'bg-blue-50 text-blue-700 border-blue-200';
                    return 'bg-purple-50 text-purple-700 border-purple-200';
                };

                const getMonth = (d) => new Date(d).toLocaleDateString('en-US', { month: 'short' });
                const getDay = (d) => new Date(d).toLocaleDateString('en-US', { day: 'numeric' });
                const formatCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'THB' }).format(val);

                return {
                    startDate, sessionCount, isSplitRoutine, hoverIndex,
                    generatedSchedule, activeSession, isActive,
                    discountedPrice, grandTotal, formatCurrency,
                    getMonth, getDay, getAreaColor, getFinishDate
                };
            }
        }).mount('#app');
    </script>
</body>
</html>